---
import { getEvents, getEvent } from "@/content";
import EventLinks from "@/components/Event/EventLinks.astro";
import EventGallery from "@/components/Event/EventGallery";
import SidebarPageLayout from "@/layouts/SidebarPageLayout.astro";
import EntryMarkdown from "@/components/Common/EntryMarkdown.astro";
import EventImageBig from "@/components/Event/EventImageBig";
import LocationCardEvent from "@/components/LocationCard/LocationCardEvent";
import EventTags from "@/components/Event/EventTags";

export async function getStaticPaths() {
  const events = await getEvents();

  return events.map(({ id }) => {
    return {
      params: { eventSlug: id },
    };
  });
}

const { eventSlug } = Astro.params;
// getEvent already returns enhanced event with responsive images
const event = await getEvent(eventSlug);

// Get topics as a description
const description = event.data.topics?.length
  ? `Topics: ${event.data.topics.join(", ")}`
  : "Join us for this exciting tech meetup event!";
---

<SidebarPageLayout title={`${event.data.title} - Events`} description={description} type="article">
  <Fragment slot="sidebar">
    <LocationCardEvent event={event} client:load />
  </Fragment>

  <Fragment slot="main-content">
    <EventImageBig event={event} client:load />
    <div class="flex flex-col gap-6 lg:hidden">
      <LocationCardEvent event={event} horizontal client:load />
    </div>
    <h1 class="mt-10 text-4xl font-bold">
      {event.data.title}
    </h1>
    <EventTags tags={event.data.topics} />
    <EntryMarkdown collection="eventsMarkdown" entryId={eventSlug} />
  </Fragment>

  <Fragment slot="after-content">
    <EventLinks eventId={event.id} />
    <EventGallery event={event} client:visible />
  </Fragment>
</SidebarPageLayout>
