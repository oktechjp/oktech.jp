---
import StatsGrid from "@/components/Common/StatsGrid";
import { icons } from "@/components/Common/StatsItem";

import Container from "@/components/Common/Container";
import { getEvents } from "@/content/events";
import Button from "../Common/Button";

// Use the filtered getters which already handle devOnly filtering
const events = await getEvents();

const venues = events.map((event) => event.venue?.title).filter((venue) => venue !== undefined);
const uniqueVenues = new Set(venues);
const uniqueVenuesCount = uniqueVenues.size;

// Calculate stats
const totalEvents = events.length;
const currentYear = new Date().getFullYear();

// Define stats with icon keys
const stats = [
  {
    title: "First Event",
    value: "2014",
    iconKey: icons.calendar,
    subTitle: "Started our Journey",
    countdown: currentYear,
  },
  {
    title: "Total Events",
    value: totalEvents.toString(),
    iconKey: icons.calendarDays,
    subTitle: "Events and counting",
  },
  {
    title: "Venues",
    value: uniqueVenuesCount.toString() + "+",
    iconKey: icons.mapPin,
    subTitle: "Places we've met",
  },
  {
    title: "Participants",
    value: "2K+",
    iconKey: icons.users,
    subTitle: "Community members",
  },
];
---

<Container wide>
  <div class="gap-responsive flex flex-col">
    <div class="flex md:items-center md:justify-center">
      <div class="grid gap-12 py-6 md:grid-cols-4">
        <h2 class="section-title col-span-4 md:col-span-2 lg:col-span-1">About OKTech</h2>
        <div class="col-span-3 flex flex-col gap-12 md:col-span-2 lg:col-start-3">
          <p class="text-xl">
            A volunteer, non-profit group organizing monthly meetups in the Kansai region of Japan.
            We invite people from all walks of web-life and encourage members to present topics they
            enjoy. Join us for technical workshops, study sessions, and social gatherings in Osaka
            and Kyoto.
          </p>
          <p>
            <Button
              className="btn-lg btn-neutral"
              text="Learn More"
              href="/about"
              ariaLabel="Learn More About OKTech"
            />
          </p>
        </div>
      </div>
    </div>
    <StatsGrid client:visible stats={stats} />
  </div>
</Container>
